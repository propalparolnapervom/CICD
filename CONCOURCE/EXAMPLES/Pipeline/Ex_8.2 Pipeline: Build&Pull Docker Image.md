# EXAMPLE 8.2 PIPELINE: Build&Pull Docker Image



Create pipeline:
  - there's a `git` repo with Dockerfile
  - Create a Pipeline to:
    - checkout that `git` repo in `xbs_source_resource` dir
    - copy it to `temp_dir`
    - update some necessary files in `temp_dir`
    - copy `temp_dir` into `xbs_source_resource_updated` dir
    - build Docker image from `xbs_source_resource_updated` dir
    - pull just built Docker image to Docker Hub


# RUN

Create a Task File `pipeline.yml`
```
---
jobs:
- name: xbs_local_job
  public: true
  plan:
    - get: xbs_source_resource
    - task: xbs_task
      config:
        platform: linux
        image_resource:
          type: docker-image
          source:
            repository: xburser2/golang
            username: xburser2
            password: xburser2
        inputs:
        - name: xbs_source_resource
        outputs:
        - name: xbs_source_resource_updated
        run:
          path: sh
          args:
            - "-ec"
            - |
                echo
                echo
                uname -a
                echo
                ls -la ; pwd
                echo
                echo cp -r xbs_source_resource temp_dir
                cp -r xbs_source_resource temp_dir
                
                echo
                echo "test22_tag" > temp_dir/tag_f_in_repo.txt

                echo
                echo cp -r temp_dir/* xbs_source_resource_updated
                cp -r temp_dir/* xbs_source_resource_updated

                echo 
                echo ls -la ; pwd
                ls -la ; pwd

                echo
                echo  ls -la xbs_source_resource_updated
                ls -la xbs_source_resource_updated

                echo
                echo cat xbs_source_resource/tag_f_in_repo.txt
                cat xbs_source_resource/tag_f_in_repo.txt

                echo
                echo cat xbs_source_resource_updated/tag_f_in_repo.txt
                cat xbs_source_resource_updated/tag_f_in_repo.txt

                
    - put: xbs_destination_resource
      params:
        build: xbs_source_resource_updated
        tag: xbs_source_resource_updated/tag_f_in_repo.txt
        tag_as_latest: true
                    
      
resources:
- name: xbs_source_resource
  type: git
  source:
    uri: https://github.com/xburser/test.git
    branch: master

- name: xbs_destination_resource
  type: docker-image
  source:
    email: sergii.burt@gmail.com 
    username: xburser2
    password: xburser2
    repository: xburser2/autogenerated

```


> Note: To push created Docker image to Docker Hub namespace has to be used, the same one as Docker Hub user name.

> For example, here `xbu/autogenerated` was used instead of just `autogenerated`




# SET PIPELINE

Set up Pipeline from just created Task File.
```
fly -t tutorial sp -c pipeline.yml -p devops311-local
```

Unpause Pipeline (if needed)
```
fly -t tutorial up -p devops311-local
```












